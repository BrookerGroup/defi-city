# DefiCity - User Stories (ภาษาไทย) - สถาปัตยกรรมแบบ Self-Custodial

**โปรเจ็กต์:** DefiCity Implementation
**เวอร์ชัน:** 2.0 (Self-Custodial)
**อัพเดทล่าสุด:** 2026-01-15
**อ้างอิงจาก:** REQUIREMENT.md, USECASE.md, TECHNICAL_DESIGN.md

---

## ภาพรวมสถาปัตยกรรม: การออกแบบแบบ Self-Custodial

**หลักการสำคัญ:** ผู้ใช้เป็นเจ้าของและควบคุมสินทรัพย์ทั้งหมดของตนเองตลอดเวลา สัญญาเกม DefiCity จะทำหน้าที่เพียงแค่บันทึกบัญชีและจดบันทึกเท่านั้น ไม่ได้ถือครองเงินของผู้ใช้

**กระบวนการของสินทรัพย์:**
```
กระเป๋า EOA ของผู้ใช้ (MetaMask, ฯลฯ)
    ↓ (เป็นเจ้าของ)
SmartWallet ของผู้ใช้ (ERC-4337 Account Abstraction)
    ↓ (ถือครองโทเค็นทั้งหมด)
    ↓ (ดำเนินการผ่าน session keys)
โปรโตคอล DeFi (Aave, Aerodrome, Megapot)

DefiCityCore (บันทึกบัญชีเท่านั้น - ไม่ถือครองโทเค็น)
    ↓ (ติดตาม)
อาคาร, สถิติ, สถานะเกม (บันทึกบัญชี)
```

**ความหมาย:**
- สินทรัพย์ของคุณอยู่ใน SmartWallet ของคุณเสมอ ไม่ได้อยู่ในสัญญาเกม
- คุณเป็นเจ้าของและควบคุมเงินทั้งหมด
- สัญญาเกมจะติดตามเฉพาะสิ่งที่คุณทำ (เหมือนสมุดบัญชี)
- Session keys อนุญาตให้ SmartWallet ของคุณดำเนินการเกม
- คุณสามารถถอนเงินโดยตรงจาก SmartWallet ของคุณได้เสมอ
- เกมไม่สามารถเข้าถึงเงินของคุณได้โดยไม่ได้รับอนุญาต

---

## สารบัญ

1. [Epic 1: การสมัครสมาชิกและการจัดการบัญชี](#epic-1-การสมัครสมาชิกและการจัดการบัญชี)
2. [Epic 2: การจัดการพอร์ตหลายสินทรัพย์](#epic-2-การจัดการพอร์ตหลายสินทรัพย์)
3. [Epic 3: อาคารศาลาว่าการ (Smart Wallet)](#epic-3-อาคารศาลาว่าการ-smart-wallet)
4. [Epic 4: อาคารธนาคาร (Aave Integration)](#epic-4-อาคารธนาคาร-aave-integration)
5. [Epic 5: อาคารร้านค้า (Aerodrome LP)](#epic-5-อาคารร้านค้า-aerodrome-lp)
6. [Epic 6: อาคารสลากกินแบ่ง (Megapot Integration)](#epic-6-อาคารสลากกินแบ่ง-megapot-integration)
7. [Epic 7: Account Abstraction และการเล่นแบบไม่เสียค่าแก๊ส](#epic-7-account-abstraction-และการเล่นแบบไม่เสียค่าแก๊ส)
8. [Epic 8: แผนที่เมืองและการแสดงผล](#epic-8-แผนที่เมืองและการแสดงผล)
9. [Epic 9: การวิเคราะห์และข้อมูลเชิงลึก](#epic-9-การวิเคราะห์และข้อมูลเชิงลึก)
10. [Story Mapping และการจัดลำดับความสำคัญ](#story-mapping-และการจัดลำดับความสำคัญ)

---

## Epic 1: การสมัครสมาชิกและการจัดการบัญชี

### US-001: สมัครสมาชิกใหม่ (ยังไม่มี Wallet)

**ในฐานะ** ผู้ใช้ DeFi มือใหม่
**ฉันต้องการ** สมัครสมาชิกด้วยอีเมลหรือโซเชียลมีเดีย
**เพื่อที่** ฉันจะเริ่มสำรวจ DefiCity และสร้างเมืองของฉัน

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถสมัครด้วยอีเมล (passwordless login)
- [ ] ผู้ใช้สามารถสมัครด้วยโซเชียลมีเดีย (Google, Twitter, Discord)
- [ ] การสมัครสร้างโปรไฟล์ผู้ใช้เท่านั้น (ยังไม่มี wallet)
- [ ] ผู้ใช้เห็นหน้าจอต้อนรับ: "วางศาลาว่าการเพื่อสร้าง wallet ของคุณ"
- [ ] ไม่ต้องจัดการ private key ด้วยตนเอง
- [ ] ขั้นตอนการสมัครใช้เวลาไม่เกิน 1 นาที
- [ ] SmartWallet จะถูกสร้างเมื่อผู้ใช้วางอาคารศาลาว่าการ
- [ ] ผู้ใช้สามารถสำรวจเกมและบทเรียนโดยไม่ต้องมี wallet

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 3 story points (ลดลง - ง่ายขึ้น)
**ขึ้นกับ:** ไม่มี

**หมายเหตุ:** การสร้าง SmartWallet เลื่อนไปที่ US-009 (วางศาลาว่าการ)

---

### US-002: เข้าสู่ระบบสำหรับสมาชิกเดิม

**ในฐานะ** ผู้ใช้ DefiCity ที่กลับมาใช้งาน
**ฉันต้องการ** เข้าสู่ระบบอย่างรวดเร็วด้วยอีเมลหรือโซเชียลมีเดีย
**เพื่อที่** ฉันจะเข้าถึงเมืองและอาคารของฉันได้โดยไม่ต้องกรอกข้อมูลซ้ำ

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเข้าสู่ระบบด้วยอีเมล (passwordless)
- [ ] ผู้ใช้สามารถเข้าสู่ระบบด้วยโซเชียลมีเดีย
- [ ] ใช้ passkey authentication (ไบโอเมตริก/PIN)
- [ ] session ก่อนหน้าถูกกลับมา (สถานะเมือง, อาคาร)
- [ ] Smart wallet เชื่อมต่อใหม่อัตโนมัติ
- [ ] การเข้าสู่ระบบใช้เวลาไม่เกิน 10 วินาที
- [ ] มีตัวเลือก "จำฉันไว้"

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-001

---

### US-003: ตั้งค่าผู้ปกป้องเพื่อกู้คืนบัญชี

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** ตั้งค่าบัญชีผู้ปกป้องสำหรับการกู้คืน wallet
**เพื่อที่** ฉันจะสามารถกู้คืนบัญชีได้ หากฉันไม่สามารถเข้าถึงวิธีการยืนยันตัวตนหลัก

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเพิ่มผู้ปกป้อง 1-3 คน
- [ ] ผู้ปกป้องสามารถเป็นที่อยู่อีเมลหรือ wallet
- [ ] การกู้คืนต้องการการอนุมัติจากผู้ปกป้อง 2 ใน 3 คน
- [ ] ผู้ใช้ได้รับการยืนยันเมื่อผู้ปกป้องถูกตั้งค่า
- [ ] ผู้ปกป้องได้รับแจ้งเตือนบทบาทของพวกเขา
- [ ] กระบวนการกู้คืนมีเอกสารอธิบายชัดเจน
- [ ] ผู้ใช้สามารถอัพเดทผู้ปกป้องภายหลัง

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-001

---

### US-004: บทเรียนแนะนำการใช้งาน

**ในฐานะ** ผู้ใช้ DefiCity ครั้งแรก
**ฉันต้องการ** เห็นบทเรียนแบบโต้ตอบสั้นๆ
**เพื่อที่** ฉันจะเข้าใจวิธีสร้างพอร์ต DeFi และใช้แพลตฟอร์ม

**เกณฑ์การยอมรับ:**
- [ ] บทเรียนแสดง 4-5 ขั้นตอนสำคัญ (ฝาก, วางอาคาร, เก็บเกี่ยว, ถอน)
- [ ] บทเรียนแบบโต้ตอบไฮไลท์องค์ประกอบ UI
- [ ] ผู้ใช้สามารถข้ามบทเรียน
- [ ] ผู้ใช้สามารถเล่นบทเรียนซ้ำจากการตั้งค่า
- [ ] บทเรียนใช้เวลาไม่เกิน 2 นาที
- [ ] มี call-to-action ชัดเจนหลังจบบทเรียน
- [ ] บทเรียนรองรับมือถือ

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-001

---

## Epic 2: การจัดการพอร์ตหลายสินทรัพย์

### US-005: ฝากเงินหลายสินทรัพย์

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** ฝาก USDC, USDT, ETH หรือ WBTC เข้า smart wallet ของฉัน
**เพื่อที่** ฉันจะสามารถใช้สินทรัพย์เหล่านี้สร้างตำแหน่ง DeFi ในเมืองของฉัน

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเลือกประเภทสินทรัพย์ (USDC, USDT, ETH, WBTC)
- [ ] ผู้ใช้สามารถกรอกจำนวนเงินฝาก
- [ ] UI แสดงยอดคงเหลือปัจจุบันของสินทรัพย์ที่เลือก
- [ ] UI แสดงจำนวนขั้นต่ำในการฝาก (ถ้ามี)
- [ ] ผู้ใช้ยืนยันธุรกรรมใน wallet
- [ ] ธุรกรรมแสดงสถานะกำลังโหลด
- [ ] ยอดคงเหลืออัพเดทหลังฝากสำเร็จ
- [ ] การแจ้งเตือนความสำเร็จแสดงพร้อม transaction hash
- [ ] ผู้ใช้จ่ายค่าแก๊สสำหรับการฝาก (ไม่ใช่ gasless)

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-001

---

### US-006: ดูพอร์ตหลายสินทรัพย์

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นการแบ่งพอร์ตตามสินทรัพย์
**เพื่อที่** ฉันจะเข้าใจว่าเงินของฉันกระจายอยู่ใน cryptocurrency ต่างๆ อย่างไร

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงยอดคงเหลือสินทรัพย์ทั้ง 4 ประเภท (USDC, USDT, ETH, WBTC)
- [ ] แสดงมูลค่าพอร์ตรวมเป็น USD
- [ ] แสดงยอดว่าง (ยังไม่ลงทุน) ต่อสินทรัพย์
- [ ] แสดงจำนวนที่ลงทุนต่อสินทรัพย์ (ในอาคาร)
- [ ] แสดงยอดรวมที่ได้รับ (ตลอดเวลา) ต่อสินทรัพย์
- [ ] แสดงการกระจายเป็นเปอร์เซ็นต์ (pie chart หรือ bar chart)
- [ ] อัพเดทราคาแบบ real-time
- [ ] ยอดคงเหลืออัพเดทหลังฝาก/ถอน

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-005

---

### US-007: ถอนเงินหลายสินทรัพย์

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** ถอนยอดว่างของฉันไปยัง wallet ภายนอก
**เพื่อที่** ฉันจะสามารถย้ายเงินออกจากแพลตฟอร์มเมื่อต้องการ

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเลือกประเภทสินทรัพย์ที่จะถอน
- [ ] ผู้ใช้สามารถกรอกจำนวนเงินถอน
- [ ] UI แสดงยอดว่าง (ยังไม่ลงทุน)
- [ ] UI ป้องกันการถอนเงินที่ลงทุนไปแล้ว
- [ ] ผู้ใช้ยืนยันธุรกรรมใน wallet
- [ ] ธุรกรรมแสดงสถานะกำลังโหลด
- [ ] ยอดคงเหลืออัพเดทหลังถอนสำเร็จ
- [ ] การแจ้งเตือนความสำเร็จแสดง
- [ ] ผู้ใช้จ่ายค่าแก๊สสำหรับการถอน (ไม่ใช่ gasless)
- [ ] ไม่สามารถถอนเกินยอดว่าง

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-006

---

### US-008: ดูประวัติธุรกรรม

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นประวัติธุรกรรมทั้งหมด
**เพื่อที่** ฉันจะติดตามการฝาก, ถอน, การวาง, การเก็บเกี่ยว และการรื้อถอน

**เกณฑ์การยอมรับ:**
- [ ] ประวัติธุรกรรมแสดงธุรกรรมทั้งหมด
- [ ] แสดงประเภทธุรกรรม (ฝาก, ถอน, วาง, เก็บเกี่ยว, รื้อถอน)
- [ ] แสดงประเภทสินทรัพย์
- [ ] แสดงจำนวน
- [ ] แสดงเวลา
- [ ] แสดง transaction hash (คลิกได้ → BaseScan)
- [ ] แสดงสถานะธุรกรรม (สำเร็จ, รอดำเนินการ, ล้มเหลว)
- [ ] กรองได้ตามประเภทธุรกรรม
- [ ] กรองได้ตามประเภทสินทรัพย์
- [ ] แบ่งหน้าเพื่อประสิทธิภาพ

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-005

---

## Epic 3: อาคารศาลาว่าการ (Smart Wallet)

### US-009: วางอาคารศาลาว่าการ (สร้าง SmartWallet)

**ในฐานะ** ผู้ใช้ DefiCity มือใหม่
**ฉันต้องการ** วางอาคารศาลาว่าการเป็นการกระทำแรก
**เพื่อที่** SmartWallet ของฉันจะถูกสร้าง และฉันสามารถเริ่มจัดการพอร์ต DeFi ได้

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้คลิก "วางศาลาว่าการ" เป็นอาคารแรก
- [ ] ระบบแจ้ง: "การกระทำนี้จะสร้าง SmartWallet ของคุณ (gasless)"
- [ ] Modal อธิบาย:
  - "ศาลาว่าการ = SmartWallet ของคุณ"
  - "คุณเป็นเจ้าของ wallet นี้ตลอดไป"
  - "สินทรัพย์ทั้งหมดจะถูกเก็บที่นี่ (self-custodial)"
  - "สร้างครั้งเดียว, ไม่สามารถรื้อถอนได้"
- [ ] ผู้ใช้ยืนยันการวาง
- [ ] SmartWallet ถูก deploy ผ่าน ERC-4337 (gasless ผ่าน Paymaster)
- [ ] EOA ของผู้ใช้ถูกตั้งเป็นเจ้าของ SmartWallet
- [ ] SmartWallet ลงทะเบียนใน DefiCityCore
- [ ] อาคารศาลาว่าการปรากฏบนแผนที่
- [ ] UI แสดง: "SmartWallet ของคุณ: 0xABC...DEF" พร้อมปุ่มคัดลอก
- [ ] บทเรียนดำเนินต่อ: "ตอนนี้ฝากเงินเข้า SmartWallet ของคุณ"
- [ ] ศาลาว่าการไม่สามารถรื้อถอนได้ (ถาวร)
- [ ] กระบวนการทั้งหมดเป็น gasless

**ลำดับความสำคัญ:** P0 (สำคัญมาก - ต้องทำก่อนอาคารอื่น)
**ประมาณการ:** 8 story points (รวมการ deploy wallet)
**ขึ้นกับ:** US-001

**กระบวนการทางเทคนิค:**
1. Frontend เรียก SmartWalletFactory.deployWallet(userEOA)
2. Factory deploy DefiCitySmartWallet (ERC-4337)
3. SmartWallet เรียก Core.registerWallet()
4. Core บันทึกอาคารศาลาว่าการ
5. Frontend แสดงที่อยู่ wallet

---

### US-010: ดูข้อมูลศาลาว่าการ

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** คลิกศาลาว่าการและดูข้อมูล wallet
**เพื่อที่** ฉันจะดูที่อยู่ smart wallet และมูลค่าพอร์ตรวม

**เกณฑ์การยอมรับ:**
- [ ] คลิกศาลาว่าการ → เปิดแผงข้อมูล
- [ ] แสดงที่อยู่ smart wallet
- [ ] แสดงปุ่มคัดลอกที่อยู่
- [ ] แสดงมูลค่าพอร์ตรวม (สินทรัพย์ทั้งหมด)
- [ ] แสดงคำอธิบาย "นี่คือ smart wallet ของคุณ"
- [ ] ไม่มีปุ่มดำเนินการ (ไม่สามารถเก็บเกี่ยว/รื้อถอน)
- [ ] ภาพแทนที่โดดเด่น (สไตล์ปราสาท/สำนักงานใหญ่)

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 2 story points
**ขึ้นกับ:** US-009

---

## Epic 4: อาคารธนาคาร (Aave Integration)

### US-011: วางอาคารธนาคาร (โหมด Supply)

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** วางอาคารธนาคารและฝากสินทรัพย์ไปยัง Aave
**เพื่อที่** ฉันจะได้รับดอกเบี้ยจากการถือ crypto

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเลือกธนาคารจากเมนูอาคาร
- [ ] ผู้ใช้สามารถเลือกสินทรัพย์ (USDC, USDT, ETH, WBTC)
- [ ] ผู้ใช้สามารถเลือกโหมด "Supply อย่างเดียว"
- [ ] ผู้ใช้กรอกจำนวนฝาก (ขั้นต่ำ $100)
- [ ] UI แสดง supply APY ปัจจุบันของ Aave
- [ ] UI แสดงค่าธรรมเนียมวางอาคาร 0.05%
- [ ] ผู้ใช้ยืนยันธุรกรรม (gasless)
- [ ] อาคารปรากฏบนแผนที่
- [ ] สินทรัพย์ถูกฝากไปยัง Aave V3
- [ ] ผู้ใช้ได้รับ aTokens (ติดตามภายใน)

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-005

---

### US-012: วางอาคารธนาคาร (โหมด Supply + Borrow)

**ในฐานะ** ผู้ใช้ DefiCity ขั้นสูง
**ฉันต้องการ** วางอาคารธนาคาร, ฝากหลักประกัน และกู้สินทรัพย์
**เพื่อที่** ฉันจะใช้ leverage ในตำแหน่งของฉันเพื่อประสิทธิภาพเงินทุนที่สูงขึ้น

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเลือกโหมด "Supply + Borrow"
- [ ] ผู้ใช้เลือกสินทรัพย์หลักประกัน (เช่น ETH)
- [ ] ผู้ใช้กรอกจำนวนหลักประกัน
- [ ] ผู้ใช้เลือกสินทรัพย์ที่จะกู้ (เช่น USDC)
- [ ] UI คำนวณจำนวนสูงสุดที่กู้ได้ตามหลักประกัน
- [ ] ผู้ใช้กรอกจำนวนกู้ (ต่ำกว่าสูงสุด)
- [ ] UI แสดง health factor (ต้อง > 1.5)
- [ ] UI แสดงคำเตือนถ้า health factor < 1.5
- [ ] UI แสดง supply APY และ borrow APY
- [ ] UI แสดง net APY (supply APY - borrow APY)
- [ ] ผู้ใช้ยืนยันธุรกรรม (gasless)
- [ ] อาคารปรากฏบนแผนที่
- [ ] หลักประกันถูกฝากไปยัง Aave
- [ ] สินทรัพย์ถูกกู้จาก Aave

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 13 story points
**ขึ้นกับ:** US-011

---

### US-013: ดูข้อมูลอาคารธนาคาร (โหมด Supply)

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารธนาคาร
**ฉันต้องการ** ดูรายละเอียดอาคารธนาคาร
**เพื่อที่** ฉันจะเห็นจำนวนที่ฝาก, ดอกเบี้ยที่ได้รับ และ APY

**เกณฑ์การยอมรับ:**
- [ ] คลิกธนาคาร → เปิดแผงข้อมูล
- [ ] แสดงประเภทสินทรัพย์ (USDC, USDT, ETH, WBTC)
- [ ] แสดงตัวบ่งชี้โหมด "Supply อย่างเดียว"
- [ ] แสดงจำนวนที่ฝาก
- [ ] แสดงมูลค่าปัจจุบัน (พร้อมดอกเบี้ยที่เพิ่ม)
- [ ] แสดง supply APY
- [ ] แสดงรางวัลที่รอรับ
- [ ] แสดงยอดรวมที่ได้รับตั้งแต่วาง
- [ ] ปุ่มดำเนินการ: ฝากเพิ่ม, เก็บเกี่ยว, รื้อถอน

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-011

---

### US-014: ดูข้อมูลอาคารธนาคาร (โหมด Borrow)

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารธนาคารในโหมดกู้
**ฉันต้องการ** ดูหลักประกัน, จำนวนที่กู้ และ health factor
**เพื่อที่** ฉันจะติดตามตำแหน่งและหลีกเลี่ยงการถูกชำระบัญชี

**เกณฑ์การยอมรับ:**
- [ ] คลิกธนาคาร → เปิดแผงข้อมูล
- [ ] แสดงสินทรัพย์หลักประกันและจำนวน
- [ ] แสดงสินทรัพย์ที่กู้และจำนวน
- [ ] แสดง health factor (สีตามระดับ: เขียว >2, เหลือง 1.5-2, แดง <1.5)
- [ ] แสดงเกณฑ์การชำระบัญชี
- [ ] แสดง supply APY และ borrow APY
- [ ] แสดง net APY
- [ ] แสดงรางวัล supply ที่รอรับ
- [ ] แสดงดอกเบี้ยรวมที่จ่ายในการกู้
- [ ] แสดงคำเตือนถ้า health factor < 1.5
- [ ] ปุ่มดำเนินการ: ฝากเพิ่ม (หลักประกัน), ชำระหนี้, เก็บเกี่ยว, รื้อถอน (ชำระหนี้เต็มแล้วเท่านั้น)

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-012

---

### US-015: เก็บเกี่ยวรางวัลธนาคาร

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารธนาคาร
**ฉันต้องการ** เก็บเกี่ยวดอกเบี้ยที่ได้รับ
**เพื่อที่** ฉันจะสามารถรับกำไรและเพิ่มในยอดว่าง

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "เก็บเกี่ยว" ในแผงข้อมูลธนาคาร
- [ ] แสดงจำนวนรางวัลที่รอรับ
- [ ] แสดงหน้าต่างยืนยัน
- [ ] ธุรกรรมเป็น gasless
- [ ] ดอกเบี้ยถอนจาก Aave (aToken → token)
- [ ] ยอดว่างเพิ่มขึ้น
- [ ] อาคารยังคงใช้งานอยู่
- [ ] การแจ้งเตือนความสำเร็จแสดง
- [ ] ยอดคงเหลืออัพเดทแบบ real-time

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-013

---

### US-016: ชำระหนี้ธนาคาร

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารธนาคารในโหมดกู้
**ฉันต้องการ** ชำระจำนวนที่กู้
**เพื่อที่** ฉันจะปรับปรุง health factor หรือปิดตำแหน่ง

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "ชำระหนี้" ในแผงข้อมูลธนาคาร
- [ ] ผู้ใช้กรอกจำนวนชำระ (หรือคลิก "สูงสุด")
- [ ] UI แสดงหนี้คงเหลือหลังชำระ
- [ ] UI แสดง health factor ใหม่หลังชำระ
- [ ] ธุรกรรมเป็น gasless
- [ ] จำนวนกู้ถูกชำระคืนไปยัง Aave
- [ ] Health factor อัพเดท
- [ ] สามารถรื้อถอนอาคารหลังชำระหนี้เต็ม
- [ ] การแจ้งเตือนความสำเร็จแสดง

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-014

---

### US-017: รื้อถอนอาคารธนาคาร

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** รื้อถอนอาคารธนาคาร
**เพื่อที่** ฉันจะถอนเงินทั้งหมดและนำช่องกลับมาใช้

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "รื้อถอน" ในแผงข้อมูลธนาคาร
- [ ] แสดงหน้าต่างยืนยันพร้อมมูลค่ารวม (เงินต้น + ดอกเบี้ย)
- [ ] ถ้ากำลังกู้: ต้องชำระหนี้เต็มก่อน (หรือแสดงข้อผิดพลาด)
- [ ] แสดงคำเตือนเกี่ยวกับการสูญเสียอาคาร
- [ ] ธุรกรรมเป็น gasless
- [ ] สินทรัพย์ทั้งหมดถอนจาก Aave
- [ ] อาคารถูกลบจากแผนที่
- [ ] ยอดว่างเพิ่มขึ้น
- [ ] การแจ้งเตือนความสำเร็จแสดง
- [ ] ช่องว่างสำหรับอาคารใหม่

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-015

---

## Epic 5: อาคารร้านค้า (Aerodrome LP)

### US-018: วางอาคารร้านค้า (ให้สภาพคล่อง)

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** วางอาคารร้านค้าและให้สภาพคล่องกับ Aerodrome
**เพื่อที่** ฉันจะได้รับค่าธรรมเนียมการเทรดและรางวัล AERO

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเลือกร้านค้าจากเมนูอาคาร
- [ ] ผู้ใช้สามารถเลือกคู่สภาพคล่อง (USDC/ETH, USDT/USDC, ETH/WBTC)
- [ ] ผู้ใช้สามารถฝากสินทรัพย์เดียว (auto-swap เป็น 50/50)
- [ ] ผู้ใช้สามารถฝากสองสินทรัพย์ (จำนวนแยก)
- [ ] ผู้ใช้กรอกจำนวนฝาก (ขั้นต่ำ $500)
- [ ] UI แสดงค่าธรรมเนียมการเทรด APY
- [ ] UI แสดงรางวัล AERO APY
- [ ] UI แสดง APY รวม
- [ ] UI แสดง impermanent loss (IL) ที่ประเมิน
- [ ] UI แสดงค่าธรรมเนียมวางอาคาร 0.05%
- [ ] ผู้ใช้ยืนยันธุรกรรม (gasless)
- [ ] อาคารปรากฏบนแผนที่
- [ ] สภาพคล่องเพิ่มในพูล Aerodrome
- [ ] ผู้ใช้ได้รับ LP tokens/NFT (ติดตามภายใน)

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 13 story points
**ขึ้นกับ:** US-005

---

### US-019: ดูข้อมูลอาคารร้านค้า

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารร้านค้า
**ฉันต้องการ** ดูรายละเอียดตำแหน่ง LP
**เพื่อที่** ฉันจะติดตามสภาพคล่อง, ค่าธรรมเนียมที่ได้รับ และ impermanent loss

**เกณฑ์การยอมรับ:**
- [ ] คลิกร้านค้า → เปิดแผงข้อมูล
- [ ] แสดงคู่สภาพคล่อง (เช่น USDC/ETH)
- [ ] แสดงมูลค่าตำแหน่ง LP
- [ ] แสดงการแบ่งตามสินทรัพย์ (จำนวนของแต่ละ token)
- [ ] แสดงค่าธรรมเนียมการเทรดที่ได้รับ
- [ ] แสดงรางวัล AERO ที่ได้รับ
- [ ] แสดง APY ปัจจุบัน (ค่าธรรมเนียม + รางวัล AERO)
- [ ] แสดงเปอร์เซ็นต์ IL ปัจจุบัน
- [ ] แสดงการเปลี่ยนแปลงมูลค่ารวมตั้งแต่วาง
- [ ] ตัวบ่งชี้ IL มีสีตามระดับ (เขียว <2%, เหลือง 2-5%, แดง >5%)
- [ ] ปุ่มดำเนินการ: ฝากเพิ่ม, เก็บเกี่ยว, รื้อถอน

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-018

---

### US-020: เก็บเกี่ยวรางวัลร้านค้า (ค่าธรรมเนียม + AERO)

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารร้านค้า
**ฉันต้องการ** เก็บเกี่ยวค่าธรรมเนียมการเทรดและรางวัล AERO
**เพื่อที่** ฉันจะรับกำไรโดยไม่ต้องถอนสภาพคล่อง

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "เก็บเกี่ยว" ในแผงข้อมูลร้านค้า
- [ ] แสดงค่าธรรมเนียมการเทรดที่รอรับ (ใน LP tokens)
- [ ] แสดงรางวัล AERO ที่รอรับ
- [ ] แสดงมูลค่ารวมเป็น USD
- [ ] ธุรกรรมเป็น gasless
- [ ] ค่าธรรมเนียมและ AERO ถูกเคลมจาก Aerodrome
- [ ] ยอดว่างเพิ่มขึ้น
- [ ] ตำแหน่ง LP ยังคงใช้งานอยู่
- [ ] การแจ้งเตือนความสำเร็จแสดง
- [ ] ยอดคงเหลืออัพเดทแบบ real-time

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-019

---

### US-021: รื้อถอนอาคารร้านค้า

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** รื้อถอนอาคารร้านค้า
**เพื่อที่** ฉันจะถอนสภาพคล่องและรับสินทรัพย์กลับมา

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "รื้อถอน" ในแผงข้อมูลร้านค้า
- [ ] แสดงหน้าต่างยืนยันพร้อม:
  - มูลค่า LP รวม
  - การแบ่งตามสินทรัพย์ (จำนวนแต่ละ token ที่คืน)
  - เปอร์เซ็นต์ IL ปัจจุบัน
  - คำเตือนเกี่ยวกับ IL ถ้า > 2%
- [ ] ธุรกรรมเป็น gasless
- [ ] สภาพคล่องถอนจาก Aerodrome
- [ ] สินทรัพย์ทั้งสองคืนสู่ยอดว่าง
- [ ] อาคารถูกลบจากแผนที่
- [ ] การแจ้งเตือนความสำเร็จแสดง
- [ ] ช่องว่างสำหรับอาคารใหม่

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-020

---

## Epic 6: อาคารสลากกินแบ่ง (Megapot Integration)

### US-022: วางอาคารสำนักงานสลากกินแบ่งรัฐบาล

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** วางอาคารสำนักงานสลากกินแบ่งรัฐบาล
**เพื่อที่** ฉันจะซื้อสลากผ่านการเชื่อมต่อ Megapot

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถเลือกสำนักงานสลากฯ จากเมนูอาคาร
- [ ] รองรับเฉพาะการฝาก USDC (ข้อกำหนด Megapot)
- [ ] ผู้ใช้กรอกจำนวน USDC (ขั้นต่ำ $10)
- [ ] UI ดึงราคาสลากปัจจุบันจาก Megapot contract
- [ ] UI คำนวณ: จำนวนสลาก = จำนวนเงิน / ราคาสลาก
- [ ] UI แสดง: "สลากจะถูกซื้อบน Megapot.io ในนามของคุณ"
- [ ] UI แสดงแจ็คพอต ($1M+) จาก Megapot
- [ ] UI แสดงคำเตือนการเล่นการพนันอย่างมีความรับผิดชอบ
- [ ] UI แสดง: "DefiCity ได้รับค่าแนะนำ"
- [ ] ผู้ใช้ยืนยันธุรกรรม (gasless)
- [ ] อาคารปรากฏบนแผนที่
- [ ] Megapot.purchaseTickets() ถูกเรียกด้วย referrer=DefiCity
- [ ] ผู้ใช้เป็นเจ้าของสลากบน Megapot contract

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-005

---

### US-023: ดูข้อมูลสำนักงานสลากกินแบ่งรัฐบาล

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารสลาก
**ฉันต้องการ** ดูแจ็คพอตปัจจุบันและข้อมูลสลากของฉัน
**เพื่อที่** ฉันจะตรวจสอบขนาดแจ็คพอตและดูว่าฉันถูกรางวัลหรือไม่

**เกณฑ์การยอมรับ:**
- [ ] คลิกอาคารสลาก → เปิดแผงข้อมูล
- [ ] แสดงจำนวนแจ็คพอต $1M+ (จาก Megapot.getJackpotAmount())
- [ ] แสดงจำนวนสลากรวมของผู้ใช้ (จาก Megapot.getUsersInfo())
- [ ] แสดง USDC รวมที่ใช้ซื้อสลาก
- [ ] แสดงนับถอยหลังไปจนถึงการจับรางวัลครั้งถัดไป (จาก Megapot.getTimeRemaining())
- [ ] แสดงข้อมูลผู้ชนะคนล่าสุด (จาก Megapot.getLastJackpotResults())
- [ ] แสดงป้าย "Powered by Megapot.io"
- [ ] แสดงลิงก์ "ดูบน Megapot.io"
- [ ] แสดงคำเตือนการเล่นการพนันอย่างมีความรับผิดชอบ
- [ ] ปุ่มดำเนินการ: ซื้อสลากเพิ่ม, ตรวจสอบรางวัล, ดูบน Megapot.io

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-022

---

### US-024: ซื้อสลากเพิ่ม

**ในฐานะ** ผู้ใช้ DefiCity ที่มีอาคารสลาก
**ฉันต้องการ** ซื้อสลากเพิ่ม
**เพื่อที่** ฉันจะเพิ่มโอกาสชนะแจ็คพอต

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "ซื้อสลากเพิ่ม"
- [ ] ผู้ใช้กรอกจำนวน USDC เพิ่มเติม
- [ ] UI ดึงราคาสลากปัจจุบันจาก Megapot
- [ ] UI คำนวณจำนวนสลากเพิ่มเติม
- [ ] UI แสดงจำนวนสลากรวมหลังซื้อ
- [ ] ธุรกรรมเป็น gasless
- [ ] Megapot.purchaseTickets() ถูกเรียก
- [ ] จำนวนสลากอัพเดทในแผงข้อมูล
- [ ] การแจ้งเตือนความสำเร็จแสดง

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-023

---

### US-025: ตรวจสอบรางวัลสลาก

**ในฐานะ** ผู้ใช้ DefiCity ที่มีสลาก
**ฉันต้องการ** ตรวจสอบว่าฉันมีรางวัลที่เคลมได้หรือไม่
**เพื่อที่** ฉันจะรู้ว่าฉันถูกรางวัลหรือไม่

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "ตรวจสอบรางวัล" ในแผงข้อมูลสลาก
- [ ] ดึง Megapot.winningsClaimable(user)
- [ ] ถ้ารางวัล = 0: แสดง "ยังไม่ถูกรางวัล"
- [ ] ถ้ารางวัล > 0: แสดง "คุณชนะ! $X.XX"
- [ ] แสดงแอนิเมชั่นฉลองถ้าชนะ
- [ ] แสดงปุ่ม "เคลมบน Megapot.io" (ลิงก์ภายนอก)
- [ ] แสดงหมายเหตุ: "การเคลมดำเนินการบน Megapot.io"
- [ ] ลิงก์เปิดหน้าเคลม Megapot.io
- [ ] แสดงคำเตือนการเล่นการพนันอย่างมีความรับผิดชอบ

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-023

---

### US-026: รื้อถอนอาคารสลาก

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** รื้อถอนอาคารสลาก
**เพื่อที่** ฉันจะนำช่องกลับมาใช้ (หมายเหตุ: ไม่คืนเงิน, สลากยังคงอยู่ใน Megapot)

**เกณฑ์การยอมรับ:**
- [ ] คลิกปุ่ม "รื้อถอน" ในแผงข้อมูลสลาก
- [ ] แสดงหน้าต่างยืนยัน:
  - "สลากยังคงอยู่บน Megapot.io"
  - "คุณยังสามารถเคลมรางวัลบน Megapot.io ได้"
  - "จะไม่มีเงินคืนสู่ wallet ของคุณ"
- [ ] ธุรกรรมเป็น gasless
- [ ] อาคารถูกลบจากแผนที่
- [ ] ช่องว่างสำหรับอาคารใหม่
- [ ] สลากของผู้ใช้ยังคงอยู่บน Megapot contract (ไม่มีผลกระทบ)
- [ ] การแจ้งเตือนความสำเร็จแสดง

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 2 story points
**ขึ้นกับ:** US-023

---

## Epic 7: Account Abstraction และการเล่นแบบไม่เสียค่าแก๊ส

### US-027: สร้าง Session Key สำหรับการเล่นแบบไม่เสียค่าแก๊ส

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** สร้าง session key
**เพื่อที่** ฉันจะเล่นเกมได้โดยไม่ต้องอนุมัติทุกธุรกรรม

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้คลิกปุ่ม "เปิดใช้งานการเล่นแบบไม่เสียค่าแก๊ส"
- [ ] แสดงหน้าต่างอธิบาย:
  - "Session key อนุญาตธุรกรรมแบบไม่เสียค่าแก๊ส"
  - "ใช้ได้ 24 ชั่วโมง"
  - "จำกัดที่ 1000 USDC/วัน"
  - "ใช้ได้เฉพาะกับ contract DefiCity"
- [ ] ผู้ใช้อนุมัติการสร้าง session key (อนุมัติครั้งเดียว)
- [ ] Session key ถูกสร้างและเก็บ (เข้ารหัสใน localStorage)
- [ ] UI แสดงตัวบ่งชี้ "เปิดใช้งานแบบไม่เสียค่าแก๊ส"
- [ ] UI แสดงเวลาหมดอายุ (นับถอยหลัง 24 ชม.)
- [ ] การดำเนินการทั้งหมดในเกมเป็น gasless (วาง, เก็บเกี่ยว, รื้อถอน, ซื้อสลาก)

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-001

---

### US-028: ดูสถานะ Session Key

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นสถานะ session key ของฉัน
**เพื่อที่** ฉันจะรู้ว่าการเล่นเป็น gasless และเมื่อไรจะหมดอายุ

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงสถานะ session key
- [ ] แสดง "ใช้งานอยู่" พร้อมตัวบ่งชี้สีเขียวเมื่อใช้ได้
- [ ] แสดง "หมดอายุ" พร้อมตัวบ่งชี้สีแดงเมื่อหมดอายุ
- [ ] แสดงเวลาที่เหลือ (นับถอยหลัง)
- [ ] แสดงลิมิตการใช้จ่ายรายวัน (1000 USDC)
- [ ] แสดงจำนวนที่ใช้จ่ายไปวันนี้
- [ ] แสดงจำนวนที่เหลือรายวัน
- [ ] แสดงปุ่ม "รีเฟรช" เมื่อเหลือเวลา < 1 ชั่วโมง

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-027

---

### US-029: รีเฟรช Session Key อัตโนมัติ

**ในฐานะ** ผู้ใช้ DefiCity ที่มี session key ใกล้หมดอายุ
**ฉันต้องการ** ให้ระบบรีเฟรช session key อัตโนมัติ
**เพื่อที่** การเล่นของฉันจะเป็น gasless ต่อไปโดยไม่ต้องดำเนินการด้วยตนเอง

**เกณฑ์การยอมรับ:**
- [ ] ระบบตรวจสอบการหมดอายุของ session key ทุก 10 นาที
- [ ] เมื่อเหลือเวลา < 1 ชั่วโมง: แสดงข้อความ "รีเฟรช session key?"
- [ ] ผู้ใช้คลิก "ใช่" → Session key ใหม่ถูกสร้างอัตโนมัติ
- [ ] ช่วงเวลาใช้งาน 24 ชั่วโมงใหม่เริ่มต้น
- [ ] การเปลี่ยนแปลงราบรื่น (ไม่มีการหยุดการเล่น)
- [ ] การแจ้งเตือนความสำเร็จ: "การเล่นแบบไม่เสียค่าแก๊สขยายแล้ว"

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-028

---

### US-030: เพิกถอน Session Key

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เพิกถอน session key ด้วยตนเอง
**เพื่อที่** ฉันจะรักษาความปลอดภัยบัญชีได้หากจำเป็น (เช่น ใช้คอมพิวเตอร์สาธารณะ)

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงปุ่ม "เพิกถอน Session Key"
- [ ] แสดงหน้าต่างยืนยัน: "นี่จะปิดการเล่นแบบไม่เสียค่าแก๊ส"
- [ ] ผู้ใช้ยืนยันการเพิกถอน
- [ ] Session key ถูกลบจาก localStorage
- [ ] Session key ถูกเพิกถอนบน smart wallet contract
- [ ] UI แสดง "ปิดใช้งานแบบไม่เสียค่าแก๊ส"
- [ ] ธุรกรรมในอนาคตต้องการการอนุมัติจาก wallet
- [ ] การแจ้งเตือนความสำเร็จแสดง

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-028

---

### US-031: ดูสถิติการไม่เสียค่าแก๊ส

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นว่าฉันประหยัดค่าแก๊สได้เท่าไหร่จากการเล่นแบบไม่เสียค่าแก๊ส
**เพื่อที่** ฉันจะเข้าใจคุณค่าของ Account Abstraction

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงส่วน "ค่าแก๊สที่ประหยัด"
- [ ] แสดงจำนวนธุรกรรมแบบไม่เสียค่าแก๊สทั้งหมด
- [ ] แสดงค่าแก๊สรวมที่ประหยัดเป็น USD
- [ ] แสดงค่าแก๊สเฉลี่ยต่อธุรกรรม
- [ ] แสดงการใช้จ่ายค่าแก๊สรายวัน (ผ่าน paymaster)
- [ ] แสดงจำนวนค่าแก๊สรายวันที่เหลือ
- [ ] เปรียบเทียบ: "คุณประหยัด $X เมื่อเทียบกับธุรกรรมปกติ"

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-027

---

### US-032: สำรองกลับเป็นธุรกรรมปกติ

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** ให้ระบบสำรองกลับเป็นธุรกรรม wallet ปกติ หาก paymaster หมด
**เพื่อที่** ฉันจะใช้แพลตฟอร์มต่อได้แม้การเล่นแบบไม่เสียค่าแก๊สไม่พร้อมใช้งาน

**เกณฑ์การยอมรับ:**
- [ ] ระบบตรวจจับว่า paymaster มียอดคงเหลือไม่เพียงพอ
- [ ] แสดงหน้าต่างคำเตือน: "การเล่นแบบไม่เสียค่าแก๊สไม่พร้อมใช้งานชั่วคราว"
- [ ] เสนอตัวเลือก: "ดำเนินการต่อด้วยธุรกรรมปกติ (คุณจ่ายค่าแก๊ส)"
- [ ] ผู้ใช้สามารถเลือกดำเนินการหรือยกเลิก
- [ ] หากดำเนินการ: ธุรกรรมใช้การอนุมัติ wallet ปกติ
- [ ] UI ระบุชัดเจน "คุณจะจ่ายค่าแก๊สสำหรับธุรกรรมนี้"
- [ ] การแจ้งเตือนความสำเร็จ: "ธุรกรรมเสร็จสมบูรณ์ (ปกติ)"

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-027

---

## Epic 8: แผนที่เมืองและการแสดงผล

### US-033: ดูแผนที่เมือง

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นแผนที่เมืองในมุมมอง isometric
**เพื่อที่** ฉันจะเห็นพอร์ต DeFi ของฉันเป็นอาคาร

**เกณฑ์การยอมรับ:**
- [ ] แผนที่แสดงในเค้าโครง isometric grid
- [ ] แสดงช่องว่าง (ว่างสำหรับอาคาร)
- [ ] แสดงอาคารที่วางแล้ว (แตกต่างตามประเภท)
- [ ] แต่ละอาคารมี sprite เฉพาะ:
  - ศาลาว่าการ: สไตล์ปราสาท/สำนักงานใหญ่
  - ธนาคาร: อาคารสมัยใหม่พร้อมแบรนด์ Aave
  - ร้านค้า: ตลาด/ร้านพร้อมแบรนด์ Aerodrome
  - สลาก: อาคารรัฐบาลพร้อมแบรนด์ Megapot
- [ ] แผนที่รองรับหน้าจอต่างๆ (มือถือ/แท็บเล็ต/เดสก์ท็อป)
- [ ] แอนิเมชั่นราบรื่น (60fps)

**ลำดับความสำคัญ:** P0 (สำคัญมาก)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-001

---

### US-034: ซูมและเลื่อนแผนที่เมือง

**ในฐานะ** ผู้ใช้ DefiCity ที่มีหลายอาคาร
**ฉันต้องการ** ซูมและเลื่อนแผนที่เมือง
**เพื่อที่** ฉันจะนำทางและดูอาคารได้ง่าย

**เกณฑ์การยอมรับ:**
- [ ] ผู้ใช้สามารถซูมเข้า/ออก (ล้อเมาส์หรือท่าทางบีบ)
- [ ] ผู้ใช้สามารถเลื่อน (คลิก-ลากหรือปัด)
- [ ] ช่วงซูม: 50% ถึง 200%
- [ ] การเลื่อนอยู่ในขอบเขตแผนที่
- [ ] แอนิเมชั่นซูม/เลื่อนราบรื่น
- [ ] ปุ่มรีเซ็ตกลับสู่มุมมองเริ่มต้น
- [ ] ระดับซูมเก็บข้ามเซสชัน

**ลำดับความสำคัญ:** P1 (สูง)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-033

---

### US-035: แสดงตัวอย่างอาคารเมื่อ Hover

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นตัวอย่างรวดเร็วเมื่อ hover บนอาคาร
**เพื่อที่** ฉันจะเข้าใจสถานะอาคารได้โดยไม่ต้องคลิก

**เกณฑ์การยอมรับ:**
- [ ] Hover บนอาคาร → tooltip ปรากฏ
- [ ] แสดงประเภทอาคาร
- [ ] แสดงประเภทสินทรัพย์
- [ ] แสดงมูลค่าปัจจุบัน
- [ ] แสดงรางวัลที่รอรับ (ถ้ามี)
- [ ] แสดงตัวบ่งชี้สถานะ (ใช้งาน, คำเตือน, ฯลฯ)
- [ ] Tooltip วางตำแหน่งไม่ปิดอาคาร
- [ ] Tooltip หายเมื่อเมาส์ออก

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 3 story points
**ขึ้นกับ:** US-033

---

### US-036: สถานะว่าง (ไม่มีอาคาร)

**ในฐานะ** ผู้ใช้ DefiCity มือใหม่ที่ไม่มีอาคาร
**ฉันต้องการ** เห็นสถานะว่างที่เป็นประโยชน์
**เพื่อที่** ฉันจะเข้าใจว่าต้องทำอะไรต่อไป

**เกณฑ์การยอมรับ:**
- [ ] แสดงเมื่อไม่มีอาคาร
- [ ] แสดงข้อความช่วยเหลือ
- [ ] แสดงตัวอย่างอาคารพร้อมประโยชน์
- [ ] ไฮไลท์ช่องที่คลิกได้ (แอนิเมชั่นกะพริบ)
- [ ] ปุ่ม "เริ่มต้น" เลื่อนไปที่ช่อง
- [ ] หายไปหลังวางอาคารแรก
- [ ] เค้าโครงรองรับมือถือ

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 2 story points
**ขึ้นกับ:** US-033

---

## Epic 9: การวิเคราะห์และข้อมูลเชิงลึก

### US-037: ดูมูลค่าพอร์ตรวมตามเวลา

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นมูลค่าพอร์ตรวมตามเวลา
**เพื่อที่** ฉันจะติดตามประสิทธิภาพพอร์ต DeFi

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงกราฟมูลค่าพอร์ต
- [ ] กราฟแสดงมูลค่าตามเวลา (จุดข้อมูลรายวัน)
- [ ] แสดงตัวเลือกช่วงเวลา (7D, 30D, 90D, 1Y, ทั้งหมด)
- [ ] แสดงมูลค่าพอร์ตรวม (สินทรัพย์ทั้งหมด + อาคาร)
- [ ] แสดงการเปลี่ยนแปลงเปอร์เซ็นต์
- [ ] แสดงการเปลี่ยนแปลงสัมบูรณ์เป็น USD
- [ ] สีตามผล (เขียวสำหรับกำไร, แดงสำหรับขาดทุน)
- [ ] กราฟโต้ตอบได้ (hover เพื่อดูมูลค่าที่เวลาเฉพาะ)

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-006

---

### US-038: ดูการแบ่งกระจายสินทรัพย์

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นว่าพอร์ตของฉันกระจายอยู่ในสินทรัพย์ต่างๆ อย่างไร
**เพื่อที่** ฉันจะเข้าใจการจัดสรรสินทรัพย์ของฉัน

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงกราฟวงกลมการกระจายสินทรัพย์
- [ ] แสดงเปอร์เซ็นต์สำหรับแต่ละสินทรัพย์ (USDC, USDT, ETH, WBTC)
- [ ] แสดงมูลค่า USD สำหรับแต่ละสินทรัพย์
- [ ] กราฟโต้ตอบได้ (hover เพื่อดูรายละเอียด)
- [ ] สีตามสินทรัพย์
- [ ] แสดงคำอธิบาย
- [ ] รวมทั้งยอดว่าง + ที่ลงทุน

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-006

---

### US-039: ดูผลตอบแทนที่ได้รับตามประเภทอาคาร

**ในฐานะ** ผู้ใช้ DefiCity
**ฉันต้องการ** เห็นว่าฉันได้รับผลตอบแทนเท่าไหร่จากแต่ละประเภทอาคาร
**เพื่อที่** ฉันจะปรับกลยุทธ์ให้เหมาะสม

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงการแบ่งผลตอบแทนตามประเภทอาคาร
- [ ] แสดงยอดรวมที่ได้รับจากอาคารธนาคาร
- [ ] แสดงยอดรวมที่ได้รับจากอาคารร้านค้า
- [ ] แสดงยอดรวมที่ใช้จ่ายในสลาก (ถ้ามี)
- [ ] แสดงเปอร์เซ็นต์ส่วนแบ่งในผลตอบแทนรวม
- [ ] แสดง APY เฉลี่ยตามประเภทอาคาร
- [ ] รูปแบบกราฟแท่งหรือตาราง
- [ ] กรองได้ตามช่วงเวลา (7D, 30D, ทั้งหมด)

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 5 story points
**ขึ้นกับ:** US-015, US-020

---

### US-040: ดูการเปรียบเทียบประสิทธิภาพอาคาร

**ในฐานะ** ผู้ใช้ DefiCity ที่มีหลายอาคาร
**ฉันต้องการ** เปรียบเทียบประสิทธิภาพระหว่างอาคารของฉัน
**เพื่อที่** ฉันจะระบุอาคารที่ดีที่สุดและแย่ที่สุด

**เกณฑ์การยอมรับ:**
- [ ] แดชบอร์ดแสดงตารางประสิทธิภาพอาคาร
- [ ] แสดงรายการอาคารทั้งหมดพร้อม:
  - ประเภทอาคาร
  - ประเภทสินทรัพย์
  - การลงทุนเริ่มต้น
  - มูลค่าปัจจุบัน
  - ยอดรวมที่ได้รับ
  - เปอร์เซ็นต์ ROI
  - APY
- [ ] เรียงลำดับได้ตามคอลัมน์ใดก็ได้
- [ ] กรองได้ตามประเภทอาคาร
- [ ] ไฮไลท์อาคารที่ดีที่สุด (เขียว)
- [ ] ไฮไลท์อาคารที่แย่ที่สุด (แดง)

**ลำดับความสำคัญ:** P2 (น่ามี)
**ประมาณการ:** 8 story points
**ขึ้นกับ:** US-015, US-020

---

## Story Mapping และการจัดลำดับความสำคัญ

### MVP (Minimum Viable Product) Stories - Phase 1 & 2

**ต้องมี (P0):**
1. US-001: สมัครสมาชิกใหม่
2. US-002: เข้าสู่ระบบสมาชิกเดิม
3. US-005: ฝากเงินหลายสินทรัพย์
4. US-006: ดูพอร์ตหลายสินทรัพย์
5. US-007: ถอนเงินหลายสินทรัพย์
6. US-011: วางอาคารธนาคาร (โหมด Supply)
7. US-013: ดูข้อมูลอาคารธนาคาร (โหมด Supply)
8. US-015: เก็บเกี่ยวรางวัลธนาคาร
9. US-017: รื้อถอนอาคารธนาคาร
10. US-018: วางอาคารร้านค้า
11. US-019: ดูข้อมูลอาคารร้านค้า
12. US-020: เก็บเกี่ยวรางวัลร้านค้า
13. US-021: รื้อถอนอาคารร้านค้า
14. US-027: สร้าง Session Key
15. US-033: ดูแผนที่เมือง

**รวม MVP Points: ~100 story points**

---

### Post-MVP Stories - Phase 3

**ควรมี (P1):**
1. US-003: ตั้งค่าผู้ปกป้องเพื่อกู้คืนบัญชี
2. US-004: บทเรียนแนะนำการใช้งาน
3. US-008: ดูประวัติธุรกรรม
4. US-009: วางอาคารศาลาว่าการ
5. US-012: วางอาคารธนาคาร (โหมด Borrow)
6. US-014: ดูข้อมูลอาคารธนาคาร (โหมด Borrow)
7. US-016: ชำระหนี้ธนาคาร
8. US-022: วางอาคารสำนักงานสลากกินแบ่งรัฐบาล
9. US-023: ดูข้อมูลสลาก
10. US-024: ซื้อสลากเพิ่ม
11. US-025: ตรวจสอบรางวัลสลาก
12. US-028: ดูสถานะ Session Key
13. US-029: รีเฟรช Session Key อัตโนมัติ
14. US-030: เพิกถอน Session Key
15. US-032: สำรองกลับเป็นธุรกรรมปกติ
16. US-034: ซูมและเลื่อนแผนที่เมือง

**รวม Phase 3 Points: ~80 story points**

---

### การพัฒนาในอนาคต - Phase 4+

**น่ามี (P2):**
1. US-010: ดูข้อมูลศาลาว่าการ
2. US-026: รื้อถอนอาคารสลาก
3. US-031: ดูสถิติการไม่เสียค่าแก๊ส
4. US-035: แสดงตัวอย่างอาคารเมื่อ Hover
5. US-036: สถานะว่าง (ไม่มีอาคาร)
6. US-037: ดูมูลค่าพอร์ตรวมตามเวลา
7. US-038: ดูการแบ่งกระจายสินทรัพย์
8. US-039: ดูผลตอบแทนที่ได้รับตามประเภทอาคาร
9. US-040: ดูการเปรียบเทียบประสิทธิภาพอาคาร

**รวม Points ในอนาคต: ~45 story points**

---

## แผนผังความเชื่อมโยง Story

```
US-001 (สมัครสมาชิก)
  ├─> US-002 (เข้าสู่ระบบ)
  ├─> US-003 (ผู้ปกป้อง)
  ├─> US-004 (บทเรียน)
  ├─> US-005 (ฝาก)
  │     ├─> US-006 (ดูพอร์ต)
  │     │     ├─> US-007 (ถอน)
  │     │     ├─> US-008 (ประวัติ)
  │     │     ├─> US-037 (พอร์ตตามเวลา)
  │     │     └─> US-038 (การกระจายสินทรัพย์)
  │     ├─> US-011 (ธนาคาร Supply)
  │     │     ├─> US-012 (ธนาคาร Borrow)
  │     │     │     ├─> US-014 (ดูข้อมูล Borrow)
  │     │     │     └─> US-016 (ชำระหนี้)
  │     │     ├─> US-013 (ดูข้อมูล Supply)
  │     │     ├─> US-015 (เก็บเกี่ยวธนาคาร)
  │     │     │     └─> US-039 (ผลตอบแทนตามอาคาร)
  │     │     └─> US-017 (รื้อถอนธนาคาร)
  │     ├─> US-018 (ร้านค้า LP)
  │     │     ├─> US-019 (ดูข้อมูลร้านค้า)
  │     │     ├─> US-020 (เก็บเกี่ยวร้านค้า)
  │     │     │     └─> US-039 (ผลตอบแทนตามอาคาร)
  │     │     └─> US-021 (รื้อถอนร้านค้า)
  │     └─> US-022 (วางสลาก)
  │           ├─> US-023 (ดูข้อมูลสลาก)
  │           ├─> US-024 (ซื้อสลากเพิ่ม)
  │           ├─> US-025 (ตรวจสอบรางวัล)
  │           └─> US-026 (รื้อถอนสลาก)
  ├─> US-009 (วางศาลาว่าการ)
  │     └─> US-010 (ดูข้อมูลศาลาว่าการ)
  ├─> US-027 (Session Key)
  │     ├─> US-028 (สถานะ Session Key)
  │     ├─> US-029 (รีเฟรชอัตโนมัติ)
  │     ├─> US-030 (เพิกถอน)
  │     ├─> US-031 (สถิติ Gasless)
  │     └─> US-032 (สำรอง)
  └─> US-033 (แผนที่เมือง)
        ├─> US-034 (ซูม/เลื่อน)
        ├─> US-035 (Hover)
        └─> US-036 (สถานะว่าง)

US-015 + US-020
  └─> US-040 (เปรียบเทียบประสิทธิภาพอาคาร)
```

---

## แนวทางการประมาณการ

- **1 point:** ง่ายมาก, < 1 วัน (เช่น การเปลี่ยน UI, มุมมองง่าย)
- **2 points:** ง่าย, 1 วัน (เช่น CRUD พื้นฐาน, ฟอร์มง่าย)
- **3 points:** ปานกลาง, 1-2 วัน (เช่น ฟีเจอร์พร้อมการตรวจสอบ)
- **5 points:** ซับซ้อน, 2-3 วัน (เช่น ขั้นตอนหลายขั้น, การเชื่อมต่อ)
- **8 points:** ซับซ้อนมาก, 3-5 วัน (เช่น การเชื่อมต่อซับซ้อน, หลาย contract)
- **13 points:** ระดับ Epic, 5-8 วัน (เช่น ประเภทอาคารใหม่พร้อมขั้นตอนเต็ม)

---

## Definition of Done (คำจำกัดความของความสำเร็จ)

สำหรับ user story ที่ถือว่า "เสร็จสมบูรณ์":

1. **การพัฒนา:**
   - [ ] เกณฑ์การยอมรับทั้งหมดผ่าน
   - [ ] โค้ดผ่านการรีวิวและอนุมัติ
   - [ ] เขียน unit tests และผ่าน (>80% coverage)
   - [ ] Integration tests ผ่าน

2. **การทดสอบ:**
   - [ ] ทดสอบด้วยตนเองบน testnet
   - [ ] ทดสอบข้าม browser (Chrome, Firefox, Safari)
   - [ ] ทดสอบการรองรับมือถือ
   - [ ] ไม่มีบั๊กลำดับสำคัญหรือสูง

3. **เอกสาร:**
   - [ ] โค้ดมีคอมเมนต์ (ตรรกะซับซ้อน)
   - [ ] API endpoints มีเอกสาร
   - [ ] การเปลี่ยนแปลงที่ผู้ใช้เห็นมีเอกสาร

4. **การติดตั้ง:**
   - [ ] ติดตั้งบน testnet
   - [ ] Smoke tests ผ่าน
   - [ ] พร้อมสำหรับการติดตั้ง mainnet

---

## หมายเหตุ

- **รองรับหลายสินทรัพย์:** ประเภทอาคารทั้งหมดยกเว้นสลากรองรับ USDC, USDT, ETH, WBTC
- **สลากรองรับเฉพาะ USDC:** การเชื่อมต่อ Megapot รับเฉพาะการฝาก USDC
- **การเล่นแบบไม่เสียค่าแก๊ส:** การดำเนินการทั้งหมดในเกม (วาง, เก็บเกี่ยว, รื้อถอน, ซื้อสลาก) เป็น gasless ผ่าน session keys
- **ธุรกรรมปกติ:** การฝากและถอนไม่ใช่ gasless (ผู้ใช้จ่ายค่าแก๊ส)
- **ไม่มีข้อกำหนดการปลดล็อก:** ประเภทอาคารทั้ง 4 แบบใช้ได้ตั้งแต่เริ่มต้น (ไม่มีระบบความก้าวหน้า)
- **ค่าธรรมเนียมอาคาร:** ค่าธรรมเนียม 0.05% ในการวางอาคาร (เก็บโดย DefiCity)
- **ค่าแนะนำ Megapot:** DefiCity ได้รับค่าแนะนำเมื่อผู้ใช้ซื้อสลาก

---

**รวม User Stories:** 40
**รวม Story Points:** ~225 points
**ระยะเวลาประมาณการ:** 16 สัปดาห์ (4 เดือน) กับนักพัฒนา full-stack 2 คน

---

**จบเอกสาร User Stories ภาษาไทย**
